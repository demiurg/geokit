{% extends "wagtailadmin/base.html" %}

{% block titletag %}Layers{% endblock %}
{% block bodyclass %}menu-layers{% endblock %}

{% block content %}
{% include "wagtailadmin/shared/header.html" with title="Layers" add_link="layers:add" add_text="Add Layer" icon="site" %}

<div class="nice-padding">
    <div id="layers-results" class="layers">
        {% if layers.exists %}
        <table class="listing">
            <col />
            <col />
            <thead>
                <tr class="table-headers">
                    <th>Name</th>
                    <th>Bounds</th>
                    <th>Field names</th>
                    <th>Features</th>
                    <th>Created</th>
                    <th>Modified</th>
                </tr>
            </thead>
            <tbody>
                {% for layer in layers %}
                <tr>
                    <td class="title">
                        <h2>
                            {% if layer.status == 0 %}
                            <a href="{% url 'layers:edit' layer.pk %}">{{ layer.name }}</a>
                            {% else %}
                            {{ layer.name }}
                            {% endif %}
                        </h2>
                    </td>
                    <td>
                        {% if layer.status == 0 %}
                        {{ layer.bounds|join:", " }}
                        {% endif %}
                    </td>
                    <td class="properties">
                        {% if layer.status == 0 %}
                        {{ layer.field_names|join:", " }}
                        {% elif layer.status == 1 %}
                        Processing...
                        {% else %}
                        Processing error
                        {% endif %}
                    </td>
                    <td>
                        {% if layer.status == 0 %}
                        {{ layer.feature_set.all.count }}
                        {% endif %}
                    </td>
                    <td>
                        {% if layer.status == 0 %}
                        <div class="human-readable-date" title="{{ layer.created|date:"d M Y H:i" }}">
                        {{ layer.created|timesince }} ago
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        {% if layer.status == 0 %}
                        <div class="human-readable-date" title="{{ layer.modified|date:"d M Y H:i" }}">
                        {{ layer.modified|timesince }} ago
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>You haven't created any layers yet. Why not <a href="{% url "layers:add" %}">create one now?</a></p>
        {% endif %}
    </div>
</div>
{% endblock %}
